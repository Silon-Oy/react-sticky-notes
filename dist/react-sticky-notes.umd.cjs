(function(b,a){typeof exports=="object"&&typeof module<"u"?a(exports,require("react/jsx-runtime"),require("react")):typeof define=="function"&&define.amd?define(["exports","react/jsx-runtime","react"],a):(b=typeof globalThis<"u"?globalThis:b||self,a(b.ReactStickyNotes={},b.jsxRuntime,b.React))})(this,(function(b,a,o){"use strict";const k=[{name:"yellow",bg:"#fef9c3",border:"#facc15",text:"#713f12"},{name:"pink",bg:"#fce7f3",border:"#f472b6",text:"#831843"},{name:"blue",bg:"#dbeafe",border:"#60a5fa",text:"#1e3a5f"},{name:"green",bg:"#dcfce7",border:"#4ade80",text:"#14532d"},{name:"orange",bg:"#ffedd5",border:"#fb923c",text:"#7c2d12"},{name:"purple",bg:"#f3e8ff",border:"#c084fc",text:"#581c87"}];function z(e){try{const n=localStorage.getItem(e);return n?JSON.parse(n):[]}catch{return[]}}function D(e,n){try{localStorage.setItem(e,JSON.stringify(n))}catch{}}async function C(e,n,u){const r=await fetch(e,{...n,headers:{"Content-Type":"application/json","X-API-Key":u,...n&&n.headers}});if(!r.ok)throw new Error(`API ${r.status}`);return r.json()}function N(e="react-sticky-notes",n=null,u=null){const r=!!n,y=`sticky-notes:${e}`,[l,p]=o.useState(()=>r?[]:z(y)),c=o.useRef(new Set),x=o.useRef({});o.useEffect(()=>{r||D(y,l)},[r,y,l]),o.useEffect(()=>{if(!r)return;let d=!0;const g=async()=>{try{const m=await C(n,{},u);if(!d)return;p(E=>{const t=m.map(s=>c.current.has(s.id)&&E.find(h=>h.id===s.id)||s);for(const s of E)c.current.has(s.id)&&!m.find(h=>h.id===s.id)&&t.push(s);return t})}catch{}};g();const f=setInterval(g,3e3);return()=>{d=!1,clearInterval(f)}},[r,n,u]);const v=o.useCallback((d,g)=>{const f={id:`n-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,x:d,y:g,text:"",colorIndex:0,minimized:!1,createdAt:Date.now()};return p(m=>[...m,f]),r&&(c.current.add(f.id),C(n,{method:"POST",body:JSON.stringify(f)},u).catch(()=>{}).finally(()=>c.current.delete(f.id))),f},[r,n,u]),i=o.useCallback((d,g)=>{p(f=>f.map(m=>m.id===d?{...m,...g}:m)),r&&(c.current.add(d),clearTimeout(x.current[d]),x.current[d]=setTimeout(()=>{C(`${n}/${d}`,{method:"PUT",body:JSON.stringify(g)},u).catch(()=>{}).finally(()=>c.current.delete(d))},150))},[r,n,u]),S=o.useCallback(d=>{p(g=>g.filter(f=>f.id!==d)),r&&(c.current.add(d),C(`${n}/${d}`,{method:"DELETE"},u).catch(()=>{}).finally(()=>c.current.delete(d)))},[r,n,u]);return{notes:l,addNote:v,updateNote:i,deleteNote:S}}const T=`@keyframes stickyNotePulse {
  0%, 100% { transform: scale(1); opacity: 0.85; }
  50% { transform: scale(1.18); opacity: 1; }
}`;let I=!1;function L(){if(I)return;const e=document.createElement("style");e.textContent=T,document.head.appendChild(e),I=!0}function $({note:e,onUpdate:n,onDelete:u}){const r=k[e.colorIndex%k.length],y=o.useRef(null),[l,p]=o.useState(!1),c=o.useRef(!1),x=o.useRef({x:0,y:0}),v=o.useRef({x:0,y:0});o.useEffect(()=>{L()},[]),o.useEffect(()=>{!e.minimized&&y.current&&requestAnimationFrame(()=>{var s;const t=(s=y.current)==null?void 0:s.querySelector("textarea");t&&t.focus()})},[e.minimized]);const i=o.useCallback((t,s)=>{v.current={x:t-e.x,y:s-e.y},x.current={x:t,y:s},c.current=!1,p(!0)},[e.x,e.y]),S=5,d=o.useCallback((t,s)=>{if(!l)return;const h=t-x.current.x,w=s-x.current.y;!c.current&&h*h+w*w<S*S||(c.current=!0,n(e.id,{x:t-v.current.x,y:s-v.current.y}))},[l,e.id,n]),g=o.useCallback(()=>{p(!1)},[]);o.useEffect(()=>{if(!l)return;const t=w=>d(w.clientX,w.clientY),s=w=>{w.preventDefault(),d(w.touches[0].clientX,w.touches[0].clientY)},h=()=>g();return window.addEventListener("mousemove",t),window.addEventListener("mouseup",h),window.addEventListener("touchmove",s,{passive:!1}),window.addEventListener("touchend",h),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",h),window.removeEventListener("touchmove",s),window.removeEventListener("touchend",h)}},[l,d,g]);const f=()=>{n(e.id,{colorIndex:(e.colorIndex+1)%k.length})},m=()=>{window.confirm("Delete this note?")&&u(e.id)},E=o.useCallback(t=>{t.relatedTarget&&t.currentTarget.contains(t.relatedTarget)||l||n(e.id,{minimized:!0})},[e.id,n,l]);return e.minimized?a.jsx("div",{onMouseDown:t=>{t.preventDefault(),i(t.clientX,t.clientY)},onTouchStart:t=>{i(t.touches[0].clientX,t.touches[0].clientY)},onClick:()=>{c.current||n(e.id,{minimized:!1})},style:{position:"fixed",left:e.x,top:e.y,width:18,height:18,borderRadius:"50%",backgroundColor:r.border,cursor:l?"grabbing":"pointer",zIndex:1e4,boxShadow:"0 1px 4px rgba(0,0,0,0.2)",animation:l?"none":"stickyNotePulse 2.5s ease-in-out infinite"},title:"Click to expand"}):a.jsxs("div",{ref:y,tabIndex:-1,onBlur:E,style:{position:"fixed",left:e.x,top:e.y,width:220,backgroundColor:r.bg,border:`1.5px solid ${r.border}`,borderRadius:8,boxShadow:l?"0 8px 24px rgba(0,0,0,0.18)":"0 2px 8px rgba(0,0,0,0.12)",zIndex:l?10002:10001,fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif",fontSize:13,userSelect:l?"none":"auto",transition:l?"none":"box-shadow 0.2s",outline:"none"},children:[a.jsxs("div",{onMouseDown:t=>{t.preventDefault(),i(t.clientX,t.clientY)},onTouchStart:t=>{i(t.touches[0].clientX,t.touches[0].clientY)},style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"5px 8px",cursor:"grab",borderBottom:`1px solid ${r.border}`,borderRadius:"8px 8px 0 0",backgroundColor:r.border+"33"},children:[a.jsx("div",{style:{width:30,height:4,borderRadius:2,backgroundColor:r.border,opacity:.5}}),a.jsxs("div",{style:{display:"flex",gap:4},children:[a.jsx("button",{onClick:f,style:{width:18,height:18,borderRadius:"50%",border:`1.5px solid ${r.text}44`,background:`conic-gradient(${k.map((t,s)=>`${t.border} ${s/k.length*100}% ${(s+1)/k.length*100}%`).join(", ")})`,cursor:"pointer",padding:0},title:"Change color"}),a.jsx("button",{onClick:()=>n(e.id,{minimized:!0}),style:{width:18,height:18,borderRadius:"50%",border:"none",background:r.text+"22",color:r.text,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,lineHeight:1,padding:0},title:"Minimize",children:"−"}),a.jsx("button",{onClick:m,style:{width:18,height:18,borderRadius:"50%",border:"none",background:"#ef444433",color:"#dc2626",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,lineHeight:1,padding:0},title:"Delete",children:"×"})]})]}),a.jsx("textarea",{value:e.text,onChange:t=>n(e.id,{text:t.target.value}),placeholder:"Write a note...",style:{width:"100%",minHeight:80,padding:"8px 10px",border:"none",background:"transparent",color:r.text,fontSize:13,fontFamily:"inherit",resize:"vertical",outline:"none",boxSizing:"border-box"}})]})}function j({storageKey:e="react-sticky-notes",apiUrl:n=null,apiKey:u=null}){const{notes:r,addNote:y,updateNote:l,deleteNote:p}=N(e,n,u),[c,x]=o.useState(!1),v=o.useCallback(i=>{i.target.closest("[data-sticky-fab]")||i.target.closest("[data-sticky-note]")||(y(i.clientX-110,i.clientY-20),x(!1))},[y]);return o.useEffect(()=>{if(!c)return;const i=S=>{S.key==="Escape"&&x(!1)};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[c]),a.jsxs(a.Fragment,{children:[c&&a.jsx("div",{onClick:v,style:{position:"fixed",inset:0,cursor:"crosshair",zIndex:9998,backgroundColor:"rgba(0,0,0,0.05)"}}),r.map(i=>a.jsx("div",{"data-sticky-note":!0,children:a.jsx($,{note:i,onUpdate:l,onDelete:p})},i.id)),a.jsx("button",{"data-sticky-fab":!0,onClick:()=>x(i=>!i),style:{position:"fixed",bottom:24,right:24,width:48,height:48,borderRadius:"50%",border:"none",backgroundColor:c?"#ef4444":"#fbbf24",color:c?"#fff":"#713f12",fontSize:24,fontWeight:"bold",cursor:"pointer",boxShadow:"0 2px 10px rgba(0,0,0,0.2)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,transition:"all 0.2s",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"},onMouseEnter:i=>{i.currentTarget.style.transform="scale(1.1)"},onMouseLeave:i=>{i.currentTarget.style.transform="scale(1)"},title:c?"Cancel (Esc)":"Add sticky note",children:c?"×":"+"})]})}b.COLORS=k,b.StickyNotes=j,b.useNotes=N,Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})}));
