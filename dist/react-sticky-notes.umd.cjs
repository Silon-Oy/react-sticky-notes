(function(x,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("react/jsx-runtime"),require("react")):typeof define=="function"&&define.amd?define(["exports","react/jsx-runtime","react"],l):(x=typeof globalThis<"u"?globalThis:x||self,l(x.ReactStickyNotes={},x.jsxRuntime,x.React))})(this,(function(x,l,i){"use strict";const S=[{name:"yellow",bg:"#fef9c3",border:"#facc15",text:"#713f12"},{name:"pink",bg:"#fce7f3",border:"#f472b6",text:"#831843"},{name:"blue",bg:"#dbeafe",border:"#60a5fa",text:"#1e3a5f"},{name:"green",bg:"#dcfce7",border:"#4ade80",text:"#14532d"},{name:"orange",bg:"#ffedd5",border:"#fb923c",text:"#7c2d12"},{name:"purple",bg:"#f3e8ff",border:"#c084fc",text:"#581c87"}];function N(e){try{const n=localStorage.getItem(e);return n?JSON.parse(n):[]}catch{return[]}}function T(e,n){try{localStorage.setItem(e,JSON.stringify(n))}catch{}}async function E(e,n,b){const r=await fetch(e,{...n,headers:{"Content-Type":"application/json","X-API-Key":b,...n&&n.headers}});if(!r.ok)throw new Error(`API ${r.status}`);return r.json()}function z(e="react-sticky-notes",n=null,b=null,r=null){const u=!!n,c=`sticky-notes:${e}`,[k,y]=i.useState(()=>{if(u)return[];const o=N(c);return r?o.filter(g=>g.page===r):o}),d=i.useRef(new Set),m=i.useRef({});i.useEffect(()=>{if(u)return;const o=N(c),g=r?o.filter(h=>h.page!==r):[];T(c,[...g,...k])},[u,c,k,r]),i.useEffect(()=>{if(!u)return;let o=!0;const g=r?`${n}?page=${encodeURIComponent(r)}`:n,h=async()=>{try{const t=await E(g,{},b);if(!o)return;y(f=>{const p=t.map(a=>d.current.has(a.id)&&f.find(I=>I.id===a.id)||a);for(const a of f)d.current.has(a.id)&&!t.find(I=>I.id===a.id)&&p.push(a);return p})}catch{}};h();const w=setInterval(h,3e3);return()=>{o=!1,clearInterval(w)}},[u,n,b,r]);const v=i.useCallback((o,g)=>{const h={id:`n-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,x:o,y:g,text:"",colorIndex:0,minimized:!1,createdAt:Date.now(),...r?{page:r}:{}};return y(w=>[...w,h]),u&&(d.current.add(h.id),E(n,{method:"POST",body:JSON.stringify(h)},b).catch(()=>{}).finally(()=>d.current.delete(h.id))),h},[u,n,b]),s=i.useCallback((o,g)=>{y(h=>h.map(w=>w.id===o?{...w,...g}:w)),u&&(d.current.add(o),clearTimeout(m.current[o]),m.current[o]=setTimeout(()=>{E(`${n}/${o}`,{method:"PUT",body:JSON.stringify(g)},b).catch(()=>{}).finally(()=>d.current.delete(o))},150))},[u,n,b]),C=i.useCallback(o=>{y(g=>g.filter(h=>h.id!==o)),u&&(d.current.add(o),E(`${n}/${o}`,{method:"DELETE"},b).catch(()=>{}).finally(()=>d.current.delete(o)))},[u,n,b]);return{notes:k,addNote:v,updateNote:s,deleteNote:C}}const $=`@keyframes stickyNotePulse {
  0%, 100% { transform: scale(1); opacity: 0.85; }
  50% { transform: scale(1.18); opacity: 1; }
}`;let D=!1;function L(){if(D)return;const e=document.createElement("style");e.textContent=$,document.head.appendChild(e),D=!0}function j({note:e,onUpdate:n,onDelete:b}){const r=S[e.colorIndex%S.length],u=i.useRef(null),[c,k]=i.useState(!1),y=i.useRef(!1),d=i.useRef({x:0,y:0}),m=i.useRef({x:0,y:0});i.useEffect(()=>{L()},[]),i.useEffect(()=>{!e.minimized&&u.current&&requestAnimationFrame(()=>{var f;const t=(f=u.current)==null?void 0:f.querySelector("textarea");t&&t.focus()})},[e.minimized]);const v=i.useCallback((t,f)=>{m.current={x:t-e.x,y:f-e.y},d.current={x:t,y:f},y.current=!1,k(!0)},[e.x,e.y]),s=5,C=i.useCallback((t,f)=>{if(!c)return;const p=t-d.current.x,a=f-d.current.y;!y.current&&p*p+a*a<s*s||(y.current=!0,n(e.id,{x:t-m.current.x,y:f-m.current.y}))},[c,e.id,n]),o=i.useCallback(()=>{k(!1)},[]);i.useEffect(()=>{if(!c)return;const t=a=>C(a.clientX,a.clientY),f=a=>{a.preventDefault(),C(a.touches[0].clientX,a.touches[0].clientY)},p=()=>o();return window.addEventListener("mousemove",t),window.addEventListener("mouseup",p),window.addEventListener("touchmove",f,{passive:!1}),window.addEventListener("touchend",p),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",p),window.removeEventListener("touchmove",f),window.removeEventListener("touchend",p)}},[c,C,o]);const g=()=>{n(e.id,{colorIndex:(e.colorIndex+1)%S.length})},h=()=>{window.confirm("Delete this note?")&&b(e.id)},w=i.useCallback(t=>{t.relatedTarget&&t.currentTarget.contains(t.relatedTarget)||c||n(e.id,{minimized:!0})},[e.id,n,c]);return e.minimized?l.jsx("div",{onMouseDown:t=>{t.preventDefault(),v(t.clientX,t.clientY)},onTouchStart:t=>{v(t.touches[0].clientX,t.touches[0].clientY)},onClick:()=>{y.current||n(e.id,{minimized:!1})},style:{position:"fixed",left:e.x,top:e.y,width:18,height:18,borderRadius:"50%",backgroundColor:r.border,cursor:c?"grabbing":"pointer",zIndex:1e4,boxShadow:"0 1px 4px rgba(0,0,0,0.2)",animation:c?"none":"stickyNotePulse 2.5s ease-in-out infinite"},title:"Click to expand"}):l.jsxs("div",{ref:u,tabIndex:-1,onBlur:w,style:{position:"fixed",left:e.x,top:e.y,width:220,backgroundColor:r.bg,border:`1.5px solid ${r.border}`,borderRadius:8,boxShadow:c?"0 8px 24px rgba(0,0,0,0.18)":"0 2px 8px rgba(0,0,0,0.12)",zIndex:c?10002:10001,fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif",fontSize:13,userSelect:c?"none":"auto",transition:c?"none":"box-shadow 0.2s",outline:"none"},children:[l.jsxs("div",{onMouseDown:t=>{t.preventDefault(),v(t.clientX,t.clientY)},onTouchStart:t=>{v(t.touches[0].clientX,t.touches[0].clientY)},style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"5px 8px",cursor:"grab",borderBottom:`1px solid ${r.border}`,borderRadius:"8px 8px 0 0",backgroundColor:r.border+"33"},children:[l.jsx("div",{style:{width:30,height:4,borderRadius:2,backgroundColor:r.border,opacity:.5}}),l.jsxs("div",{style:{display:"flex",gap:4},children:[l.jsx("button",{onClick:g,style:{width:18,height:18,borderRadius:"50%",border:`1.5px solid ${r.text}44`,background:`conic-gradient(${S.map((t,f)=>`${t.border} ${f/S.length*100}% ${(f+1)/S.length*100}%`).join(", ")})`,cursor:"pointer",padding:0},title:"Change color"}),l.jsx("button",{onClick:()=>n(e.id,{minimized:!0}),style:{width:18,height:18,borderRadius:"50%",border:"none",background:r.text+"22",color:r.text,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,lineHeight:1,padding:0},title:"Minimize",children:"−"}),l.jsx("button",{onClick:h,style:{width:18,height:18,borderRadius:"50%",border:"none",background:"#ef444433",color:"#dc2626",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,lineHeight:1,padding:0},title:"Delete",children:"×"})]})]}),l.jsx("textarea",{value:e.text,onChange:t=>n(e.id,{text:t.target.value}),placeholder:"Write a note...",style:{width:"100%",minHeight:80,padding:"8px 10px",border:"none",background:"transparent",color:r.text,fontSize:13,fontFamily:"inherit",resize:"vertical",outline:"none",boxSizing:"border-box"}})]})}function M({storageKey:e="react-sticky-notes",apiUrl:n=null,apiKey:b=null,page:r=null}){const{notes:u,addNote:c,updateNote:k,deleteNote:y}=z(e,n,b,r),[d,m]=i.useState(!1),v=i.useCallback(s=>{s.target.closest("[data-sticky-fab]")||s.target.closest("[data-sticky-note]")||(c(s.clientX-110,s.clientY-20),m(!1))},[c]);return i.useEffect(()=>{if(!d)return;const s=C=>{C.key==="Escape"&&m(!1)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[d]),l.jsxs(l.Fragment,{children:[d&&l.jsx("div",{onClick:v,style:{position:"fixed",inset:0,cursor:"crosshair",zIndex:9998,backgroundColor:"rgba(0,0,0,0.05)"}}),u.map(s=>l.jsx("div",{"data-sticky-note":!0,children:l.jsx(j,{note:s,onUpdate:k,onDelete:y})},s.id)),l.jsx("button",{"data-sticky-fab":!0,onClick:()=>m(s=>!s),style:{position:"fixed",bottom:24,right:24,width:48,height:48,borderRadius:"50%",border:"none",backgroundColor:d?"#ef4444":"#fbbf24",color:d?"#fff":"#713f12",fontSize:24,fontWeight:"bold",cursor:"pointer",boxShadow:"0 2px 10px rgba(0,0,0,0.2)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,transition:"all 0.2s",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"},onMouseEnter:s=>{s.currentTarget.style.transform="scale(1.1)"},onMouseLeave:s=>{s.currentTarget.style.transform="scale(1)"},title:d?"Cancel (Esc)":"Add sticky note",children:d?"×":"+"})]})}x.COLORS=S,x.StickyNotes=M,x.useNotes=z,Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})}));
